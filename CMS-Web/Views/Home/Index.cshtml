@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@model CMS_DTO.CMSProduct.ProductViewModels
@using CMS_Shared;
@{
    var _ListSlider = Session["SliderSession"] as List<CMS_DTO.CMSSession.SliderSession>;
    var _count = 0;
}
          
<main class="main-content" ng-controller="CartCtrl">
    <section id="slideshow" class="clearfix">
        <div class="slider-container ">
            <div id="sliderlayer" class="apollo_slides clearfix">
                @if (_ListSlider != null && _ListSlider.Any())
                {
                    var _Index = 0;
                    foreach (var item in _ListSlider)
                    {
                        if (_Index == 0)
                        {
                            <a href="" class="slide-link">
                                <img class="img-responsive" alt="wooden clock" src="@Url.Content(item.ImageUrl)"
                                     title="#htmlcaption1" />
                            </a>
                        }
                        else
                        {
                            <img class="img-responsive" alt="Wood cup of tea" src="@Url.Content(item.ImageUrl)"
                                 title="#htmlcaption2" />
                        }
                        _Index++;
                    }
                }


            </div>
            <div id="htmlcaption1" class="apollo-html-caption">
                <div class="caption-fullwidth container">
                    <div class="slide-caption caption_1">
                        <div class="">
                            <div class="text_first" style="color:#000000">SANG TRỌNG & QUÝ PHÁI</div>
                            <h3 style="color:#000000">KIDSWATCH </h3>
                            <p style="color:#666666">
                                Cuộc sống của bạn chỉ có thể trở nên khá hơn khi bạn hành động. Làm điều gì đó mỗi ngày để cải thiện kỹ năng then chốt trong lĩnh vực của bạn!
                            </p>
                            <a class="btn btn-slide" href="@Url.Action("Index","Shop")" title="Shop Now">Mua hàng</a>

                        </div>
                    </div>
                </div>
            </div>
            <div id="htmlcaption2" class="apollo-html-caption">
                <div class="caption-fullwidth container">
                    <div class="slide-caption caption_2">
                        <div class="">
                            <div class="text_first" style="color:#000000">SANG TRỌNG & QUÝ PHÁI</div>
                            <h3 style="color:#000000">KIDSWATCH</h3>
                            <p style="color:#666666">
                                Cuộc sống của bạn chỉ có thể trở nên khá hơn khi bạn hành động. Làm điều gì đó mỗi ngày để cải thiện kỹ năng then chốt trong lĩnh vực của bạn!
                            </p>
                            <a class="btn btn-slide" href="@Url.Action("Index","Shop")" title="Shop now">Mua hàng</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script>
            $(document).ready(function () {
                $('#sliderlayer').nivoSlider({
                effect: 'random',
                animSpeed: 500,
                pauseTime: 80000
                });
                $('#sliderlayer').on('swipeleft', function (e) {
                $('a.nivo-nextNav').trigger('click');
                e.stopPropagation();
                return false;
                });
                $('#sliderlayer').on('swiperight', function (e) {
                $('a.nivo-prevNav').trigger('click');
                e.stopPropagation();
                return false;
                });
            });
        </script>
    </section>

    <section id="columns" class="columns-container">
        <div class="container">
            <div class="row">
                <aside>
                    <div id="left_column" class="left_column sidebar col-xs-12 col-sm-4 col-md-3">
                        <div id="categories_block" class="block sidebarCategories ">
                            <h4 class="title_block">Bộ sưu tập</h4>
                            <div class="block_content" style="">
                                <ul class="listSidebar list-unstyled">
                                    @if (Model.ListCate != null && Model.ListCate.Any())
                                    {
                                        foreach (var item in Model.ListCate)
                                        {
                                            <li>
                                                <a href="@Url.Action("Detail","Collection",new { id=item.Id})" title="@item.CategoryName">
                                                    @string.Format("{0}", item.CategoryName.Length > 30 ? item.CategoryName.Substring(0, 30) + "..." : item.CategoryName)
                                                    <span id="" class="apolloQty pull-right">@item.NumberOfProduct</span>
                                                </a>
                                            </li>
                                        }
                                    }                                    
                                </ul>
                            </div>
                        </div>
                        <div id="shopbyvendor" class="block block_shopby ">
                            <div class="title_block">
                                Thương hiệu
                            </div>
                            <div class="block_content" style="">
                                <ul id="ul_catalog_vendor" class="listSidebar list-unstyled">
                                    @if (Model.ListBrand != null && Model.ListBrand.Any())
                                    {
                                        foreach (var item in Model.ListBrand)
                                        {
                                            <li data-group="BRANDS">
                                                <a title="@item.BrandName" style="cursor:pointer">
                                                    @string.Format("{0}", item.BrandName.Length > 30 ? item.BrandName.Substring(0, 30) + "..." : item.BrandName)
                                                    <span id="" class="apolloQty pull-right">@item.NumberOfProduct</span>
                                                </a>
                                            </li>
                                        }
                                    }                                    
                                </ul>
                            </div>
                        </div>
                        <div id="products_sider_block" class="block products_block nopadding ">
                            <h4 class="title_block">
                                <a title="Best Sellers">Sản phẩm mới nhất</a>
                            </h4>
                            <div class="block_content products-block" style="">
                                <ul class="products products-block list-unstyled">
                                    @if (Model.ListProductTopSales != null && Model.ListProductTopSales.Any())
                                    {
                                        foreach (var item in Model.ListProductTopSales)
                                        {
                                            <li class="media clearfix">
                                                <div class="product-block">
                                                    <div class="product-container media">
                                                        <a class="products-block-image img pull-left" href="@Url.Action("Detail","Shop",new { id=item.Id})" title="@item.ProductName">
                                                            <img class="replace-2x img-responsive" src="@item.ImageURL" alt="@item.ProductName">
                                                        </a>
                                                        <div class="media-body">
                                                            <div class="product-content">
                                                                <h5 class="name media-heading">
                                                                    <a class="product-name" href="@Url.Action("Detail", "Shop",new { id= item.Id})" title="Clock Wooden">@string.Format("{0}", item.ProductName.Length > 20 ? item.ProductName.Substring(0, 20) + "..." : item.ProductName)</a>
                                                                </h5>
                                                                <div class="content_price price">
                                                                    <span class="price product-price">
                                                                        <span class="money">@item.ProductPrice.ToString("#,00") VNĐ</span>
                                                                    </span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </li>
                                        }
                                    }
                                </ul>
                            </div>
                        </div>
                    </div>
                </aside>
                <div id="center_column" class="center_column col-xs-12 col-sm-8 col-md-9">
                    <div class="content_scene_cat"> </div>
                    <h1 class="page-heading product-listing cat-name">Sản phẩm chúng tôi</h1>
                    <div class="category-heading clearfix">
                        <div class="sortPagiBar clearfix row">
                            <div class="col-md-6 col-sm-6 col-xs-4">
                                <div class="collection-view">
                                    <button type="button" title="Grid view" class="change-view change-view--active" data-view="grid">
                                        <span class="icon-fallback-text">
                                            <span class="fa fa-th-large" aria-hidden="true"></span>
                                            <span class="fallback-text">Danh sách</span>
                                        </span>
                                    </button>
                                    <button type="button" title="List view" class="change-view" data-view="list">
                                        <span class="icon-fallback-text">
                                            <span class="fa fa-list-ul" aria-hidden="true"></span>
                                            <span class="fallback-text">Sản phẩm</span>
                                        </span>
                                    </button>
                                </div>
                            </div>
                            <div class="col-md-6 col-sm-6 col-xs-8">
                                <div class="form-horizontal">
                                    <label for="">Sắp xếp</label>
                                    @Html.DropDownListFor(model => model.RangeType,
                                    new SelectList(ViewBag.Range, "Value", "Text", Model.RangeType), null,
                                    new
                                    {
                                        @class = "",
                                        @id = "SortBy",
                                        @style = ""
                                    })
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="product_list" class="product_list grid">
                        @Html.Partial("_ListItem", Model);
                    </div>
                    <div class="content_sortPagiBar">
                        <div id="pagination" class="clearfix">
                            @if (Model.TotalPage > 0)
                            {
                                <ul class="pagination">
                                    <li class="pagination_previous disabled" onclick="PrevPage();">
                                        <span><i class="fa fa-chevron-left"></i></span>
                                    </li>
                                    @for (var i = 1; i <= Model.TotalPage; i++)
                                    {

                                        if (i == 1)
                                        {
                                            @*<li class="active"><span>1</span></li>*@
                                            <li class="active" id="page_@i" data-page="@i" onclick="ChoosePage(@i,this)"><a style="cursor:pointer;" title="">@i</a></li>
                                        }
                                        else
                                        {
                                            <li onclick="ChoosePage(@i,this)" id="page_@i" data-page="@i"><a style="cursor:pointer;" title="">@i</a></li>
                                        }
                                    }
                                    <li class="pagination_next" onclick="NextPage()"><span><i class="fa fa-chevron-right"></i></span></li>
                                </ul>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>

<script>
    function ChoosePage(pageIndex, that)
    {
        $("[id=pagination]").find("li").removeClass("active");
        $(that).addClass("active");
                                        if (pageIndex != 1)
                                        {
            $(".pagination_previous").removeClass("disabled");
                                        }
                                        else {
            $(".pagination_previous").addClass("disabled");
                                        }

                                        if (pageIndex == '@Model.TotalPage')
            $(".pagination_next").addClass("disabled");
        else
            $(".pagination_next").removeClass("disabled");

                                        LoadDataPagging(pageIndex);
                                    }

                                    function PrevPage() {
                                        var pageIndex = 1;
        $("#pagination li").each(function (index) {
                                            if ($(this).hasClass("active"))
            {
                                        var PageIndex = parseInt($(this).attr("data-page"));
                $("[id=pagination]").find("li").removeClass("active");
                                        if (PageIndex > 1)
                                        {
                                            pageIndex = PageIndex - 1;
                    $('[id=page_' + (PageIndex - 1) + ']').addClass("active");
                                        }
                                        else
                    $('[id=page_1]').addClass("active");
                                        if ((PageIndex - 1) == 1)
                                        {
                    $(".pagination_previous").addClass("disabled");
                                        }

                                        return false;
                                    }
                                });
        LoadDataPagging(pageIndex);
                            }

                            function NextPage() {
        $(".pagination_previous").removeClass("disabled");
                                var totalPage = '@Model.TotalPage';
                                var pageIndex = '@Model.TotalPage';
        $("#pagination li").each(function (index) {
                                    if ($(this).hasClass("active")) {
                                        var PageIndex = parseInt($(this).attr("data-page"));
                $("[id=pagination]").find("li").removeClass("active");
                                        if (PageIndex > totalPage) {
                    $('[id=page_' + totalPage + ']').addClass("active");
                                        }
                                        else {
                                            pageIndex = parseInt(PageIndex) + 1;
                    $('[id=page_' + pageIndex + ']').addClass("active");
                                        }

                                        if ((PageIndex + 1) == '@Model.TotalPage') {
                    $(".pagination_next").addClass("disabled");
                                        }
                                        return false;
                                    }
                                });
                                LoadDataPagging(pageIndex);
                            }

                            function LoadDataPagging(pageIndex)
                            {
         $.ajax({
                                    url: "@Url.Action("LoadDataPagging", "Home")",
                type: "GET",
                data: { pageIndex: pageIndex },
                dataType: 'html',
                beforeSend: function () {
                                        //  $('.se-pre-con').show();
                                    },
                success: function (data) {
                    $('[id=product_list]').html(data);
                                    },
                complete: function () {
                                        //  $('.se-pre-con').hide();
                                    },
                error: function (jqXHR, textStatus, errorThrown) {
                                    }
                                });
                            }
</script>